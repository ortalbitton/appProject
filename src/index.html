<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>AppProject</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!--<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->
  <!--<link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
  <script src="https://openlayers.org/en/v4.6.5/build/ol.js" type="text/javascript"></script>-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>

  <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
  <script src="https://openlayers.org/en/v4.6.5/build/ol.js" type="text/javascript"></script>

  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.js"></script>
</head>

<body>
  <app-root></app-root>

  <script>
    var app = angular.module('chartApp', []);
    var salesDataToPlot;

    app.controller('SalesController', ['$scope', function ($scope) {
      $scope.salesData = [{
          hour: 1,
          sales: 54
        },
        {
          hour: 2,
          sales: 66
        },
        {
          hour: 3,
          sales: 77
        },
        {
          hour: 4,
          sales: 70
        },
        {
          hour: 5,
          sales: 60
        },
        {
          hour: 6,
          sales: 63
        },
        {
          hour: 7,
          sales: 55
        },
        {
          hour: 8,
          sales: 47
        },
        {
          hour: 9,
          sales: 55
        },
        {
          hour: 10,
          sales: 30
        }
      ];
    }]);

    app.directive('linearChart', function ($window) {
      return {
        restrict: 'EA',
        template: "<svg width='850' height='200'></svg>",
        scope: {
          data: '='
        },
        link: function (scope, elem, attrs) {
          salesDataToPlot = scope.data;
          var padding = 20;
          var pathClass = "path";
          var xScale, yScale, xAxisGen, yAxisGen, lineFun;

          var d3 = $window.d3;
          var rawSvg = elem.find('svg');
          var svg = d3.select(rawSvg[0]);

          function setChartParameters() {
            console.log(salesDataToPlot);

            xScale = d3.scaleLinear()
              .domain([salesDataToPlot[0].hour, salesDataToPlot[salesDataToPlot.length - 1].hour])
              .range([padding + 5, rawSvg.attr("width") - padding]);

            yScale = d3.scaleLinear()
              .domain([0, d3.max(salesDataToPlot, function (d) {
                return d.sales;
              })])
              .range([rawSvg.attr("height") - padding, 0]);

            xAxisGen = d3.axisBottom()
              .scale(xScale)
              .ticks(salesDataToPlot.length - 1);

            yAxisGen = d3.axisLeft()
              .scale(yScale)
              .ticks(5);

            lineFun = d3.line()
              .x(function (d) {
                console.log(xScale(d.hour));
                return xScale(d.hour);
              })
              .y(function (d) {
                console.log(yScale(d.sales));
                return yScale(d.sales);
              })
              .curve(d3.curveLinear);
          }

          function drawLineChart() {

            setChartParameters();

            svg.append("svg:g")
              .attr("class", "x axis")
              .attr("transform", "translate(0,180)")
              .call(xAxisGen);

            svg.append("svg:g")
              .attr("class", "y axis")
              .attr("transform", "translate(20,0)")
              .call(yAxisGen);

            svg.append("svg:path")
              .attr('d', lineFun(salesDataToPlot))
              .attr('stroke', 'blue')
              .attr('stroke-width', 2)
              .attr('fill', 'none');

          }

          drawLineChart();
        }
      };
    });

  </script>

</body>


</html>
